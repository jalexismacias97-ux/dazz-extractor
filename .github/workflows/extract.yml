name: Extractor V7 (CDN Directo)

on: [push]

jobs:
  extract_assets_final:
    runs-on: macos-latest

    steps:
      - name: 1. Descargar Tu Repositorio
        uses: actions/checkout@v3

      - name: 2. üõ† Descargar Cartool (V√≠a CDN)
        run: |
          echo "Descargando c√≥digo fuente desde servidor seguro..."
          # Usamos el servidor de carga de c√≥digo (codeload) que no requiere autenticaci√≥n
          curl -L -o cartool.zip "https://codeload.github.com/0xced/cartool/zip/refs/heads/master"
          
          # Verificar que baj√≥ algo
          ls -lh cartool.zip
          
          # Descomprimir
          unzip -q cartool.zip
          
          # Renombrar la carpeta descomprimida (suele llamarse cartool-master)
          mv cartool-master cartool

      - name: 3. üî® Compilar Herramienta
        run: |
          cd cartool
          # Compilamos la herramienta usando el Xcode de la Mac virtual
          xcodebuild -scheme cartool -configuration Release

      - name: 4. üîç Localizar y Extraer
        run: |
          mkdir output_images
          
          # Buscamos tu archivo
          FILE=$(find . -maxdepth 3 -type f -name "[Aa]ssets.car" | head -n 1)
          
          if [ -z "$FILE" ]; then
            echo "‚ùå ERROR: No encuentro Assets.car"
            ls -R
            exit 1
          fi
          
          echo "‚úÖ Archivo encontrado: $FILE"
          
          # Ejecutamos la herramienta compilada
          ./cartool/build/Release/cartool "$FILE" output_images/

      - name: 5. üì¶ Subir Resultados
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: Filtros-Dazz-Extraidos
          path: output_images/
