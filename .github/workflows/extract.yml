name: Extractor V10 (VÃ­a Homebrew)

on: [push]

jobs:
  extract_assets:
    runs-on: macos-latest

    steps:
      - name: 1. Descargar Tu Repositorio
        uses: actions/checkout@v3

      - name: 2. ðŸº Instalar Cartool desde Homebrew
        run: |
          echo "Conectando con la tienda de fÃ³rmulas..."
          # AÃ±adimos el repositorio de fÃ³rmulas de Keith (muy famoso en iOS dev)
          brew tap keith/formulae
          
          echo "Instalando cartool..."
          # Instalamos la herramienta ya compilada.
          # Homebrew maneja los espejos de descarga automÃ¡ticamente.
          brew install cartool
          
          # Verificamos que se instalÃ³
          which cartool
          cartool --version || echo "Cartool instalado correctamente"

      - name: 3. ðŸ” Localizar Assets.car
        id: find_file
        run: |
          # Buscamos tu archivo
          FILE=$(find . -maxdepth 3 -type f -name "[Aa]ssets.car" | head -n 1)
          
          if [ -z "$FILE" ]; then
            echo "âŒ ERROR: No encuentro Assets.car"
            ls -R
            exit 1
          fi
          
          echo "found_file=$FILE" >> $GITHUB_OUTPUT
          echo "âœ… Archivo encontrado: $FILE"

      - name: 4. ðŸš€ EJECUTAR EXTRACCIÃ“N
        run: |
          mkdir output_images
          FILE="${{ steps.find_file.outputs.found_file }}"
          
          echo "Extrayendo $FILE..."
          # Ejecutamos el comando directo (ya estÃ¡ en el PATH)
          cartool "$FILE" output_images/

      - name: 5. ðŸ“¦ Subir Resultados
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: Filtros-Dazz-Originales
          path: output_images/
