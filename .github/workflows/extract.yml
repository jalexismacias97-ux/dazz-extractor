name: Extractor V17 (Victoria Final)

on: [push]

jobs:
  extract_assets:
    runs-on: macos-latest

    steps:
      - name: 1. Descargar Tu Repositorio
        uses: actions/checkout@v3

      - name: 2. üõ† Clonar Herramienta
        run: |
          git config --global --unset credential.helper || true
          git clone https://github.com/steventroughtonSmith/cartool.git tool_src

      - name: 3. üíâ APLICAR PARCHE
        run: |
          cd tool_src/cartool
          sed -i '' '1s/^/#import <ImageIO\/ImageIO.h>\n/' main.m

      - name: 4. üî® COMPILAR (Forzando Ruta)
        run: |
          cd tool_src
          # TRUCO: DSTROOT y SYMROOT obligan a Xcode a dejar el archivo aqu√≠
          xcodebuild -scheme cartool -configuration Release clean build SYMROOT="build"

      - name: 5. üîç EJECUTAR EXTRACCI√ìN
        run: |
          mkdir output_images
          
          # Buscamos tu archivo
          FILE=$(find . -maxdepth 3 -type f -name "[Aa]ssets.car" | head -n 1)
          
          echo "Usando archivo: $FILE"
          
          # Buscamos d√≥nde demonios dej√≥ Xcode la herramienta
          TOOL=$(find tool_src -name "cartool" -type f -perm +0111 | head -n 1)
          
          echo "Herramienta encontrada en: $TOOL"
          
          # Ejecutamos
          "$TOOL" "$FILE" output_images/

      - name: 6. üì¶ Subir Resultados
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: Filtros-Dazz-Originales
          path: output_images/
