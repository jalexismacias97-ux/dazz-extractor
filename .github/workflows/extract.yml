name: Extractor Infalible (GH CLI)

on: [push]

jobs:
  extract_assets:
    runs-on: macos-latest
    permissions:
      contents: read

    steps:
      - name: 1. Descargar tu repositorio
        uses: actions/checkout@v3

      - name: 2. üõ† Descargar herramienta (Modo Oficial)
        run: |
          # Usamos la herramienta oficial de GitHub (gh) para clonar
          # Esto evita errores de contrase√±a y enlaces rotos
          gh repo clone 0xced/cartool tool_temp
          mv tool_temp cartool

      - name: 3. üî® Compilar herramienta
        run: |
          cd cartool
          xcodebuild -scheme cartool -configuration Release

      - name: 4. üöÄ EJECUTAR EXTRACCI√ìN
        run: |
          mkdir output_images
          
          # Buscamos el archivo Assets.car donde sea que est√©
          FILE=$(find . -type f -name "[Aa]ssets.car" | head -n 1)
          
          if [ -z "$FILE" ]; then
            echo "‚ùå ERROR: No encuentro el archivo Assets.car en ning√∫n lado."
            echo "Listado de archivos:"
            ls -R
            exit 1
          else
            echo "‚úÖ Archivo encontrado en: $FILE"
            # Ejecutamos la herramienta
            ./cartool/build/Release/cartool "$FILE" output_images/
          fi

      - name: 5. üì¶ Subir Resultados
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: Filtros-Finales-VIP
          path: output_images/
