name: Extractor V3 (M√©todo ZIP)

on: [push]

jobs:
  extract_assets:
    runs-on: macos-latest

    steps:
      - name: 1. Descargar tu repositorio
        uses: actions/checkout@v3

      - name: 2. üõ† Descargar herramienta (SIN GIT)
        run: |
          # AQU√ç EST√Å EL ARREGLO:
          # En lugar de clonar, descargamos el ZIP directamente.
          # Esto evita el error de "Device not configured" / "Username".
          curl -L https://github.com/0xced/cartool/archive/refs/heads/master.zip -o cartool.zip
          unzip -q cartool.zip
          mv cartool-master cartool

      - name: 3. üî® Compilar herramienta
        run: |
          cd cartool
          xcodebuild -scheme cartool -configuration Release

      - name: 4. üöÄ EJECUTAR EXTRACCI√ìN
        run: |
          mkdir output_images
          
          # Buscamos el archivo ignorando may√∫sculas/min√∫sculas
          # Esto encuentra Assets.car o assets.car autom√°ticamente
          FILE=$(find . -maxdepth 1 -iname "assets.car" | head -n 1)
          
          if [ -z "$FILE" ]; then
            echo "‚ùå ERROR: No encuentro el archivo Assets.car"
            echo "Archivos en la carpeta actual:"
            ls -la
            exit 1
          else
            echo "‚úÖ Archivo encontrado: $FILE"
            # Ejecutamos la herramienta compilada
            ./cartool/build/Release/cartool "$FILE" output_images/
          fi

      - name: 5. üì¶ Subir Resultados
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: Filtros-Extraidos
          path: output_images/
